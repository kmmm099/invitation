<!DOCTYPE html>
<html lang="ja">
  <head>
    <link rel="icon" href="favicon.jpg" type="image/png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>離婚式へようこそ</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Marcellus&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        margin: 0;
        font-family: 'Marcellus', 'Noto Serif JP', serif;
        background: url('background.png') no-repeat center center fixed;
        background-size: cover;
        color: #4a3b2c;
        line-height: 1.8;
      }
      header, section {
        padding: 4rem 2rem;
        text-align: center;
      }
      h1, h2 {
        font-family: 'Great Vibes', cursive;
        color: #a67c52;
        font-size: 2.5rem;
        line-height: 1.4;
        letter-spacing: 0.05em;
      }
      .section-title {
        font-size: 2.2rem;
        font-weight: normal;
        margin-bottom: 1.5rem;
        font-family: 'Marcellus', 'Noto Serif JP', serif;
      }
      .image {
        max-width: 100%;
        height: auto;
        margin: 2rem 0;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .item {
        margin-bottom: 3rem;
      }

      .board {
  margin: 2rem auto;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
      .board input[type="text"],
      .board textarea {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        border-radius: 8px;
        border: 1px solid #d4cfc9;
        margin-bottom: 0.5rem;
      }
      .board textarea {
        height: 100px;
        resize: vertical;
      }
      .board button {
        margin-top: 0.5rem;
        padding: 0.5rem 1.5rem;
        background-color: #a67c52;
        color: black;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .messages {
        margin-top: 2rem;
        background-color: #fdfaf7;
        border: 1px solid #e5ded7;
        padding: 1rem;
        border-radius: 10px;
      }
      .message {
        padding: 0.5rem 0;
        border-bottom: 1px solid #e5ded7;
      }
      .animate-on-scroll {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 1s ease, transform 1s ease;
      }
      .animate-on-scroll.visible {
        opacity: 1;
        transform: none;
      }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAavEeeyF0nO6LAvom8Msjy_Oqm3Uo6HrY",
        authDomain: "invitation-581b5.firebaseapp.com",
        databaseURL: "https://invitation-581b5-default-rtdb.firebaseio.com",
        projectId: "invitation-581b5",
        storageBucket: "invitation-581b5.firebasestorage.app",
        messagingSenderId: "718282571964",
        appId: "1:718282571964:web:339ff6fc9d27002852d0b9",
        measurementId: "G-DCBMW5ECX3"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

   document.addEventListener("DOMContentLoaded", function () {
  db.ref("messages").orderByChild("timestamp").on("child_added", snapshot => {
    const data = snapshot.val();
    document.querySelectorAll(".messages").forEach(messagesDiv => {
      const messageElement = document.createElement("div");
messageElement.classList.add("message");

if (data.name === "元新郎GPT" || data.name === "AI侑汰") {
  const emotion = data.emotion || "neutral";
  const iconMap = {
    happy: "happy.png",
    sad: "sad.png",
    angry: "angry.png",
    neutral: "gpt-icon.png"
  };
  const iconSrc = iconMap[emotion] || "gpt-icon.png";

  messageElement.style.marginLeft = "2rem";
  messageElement.style.fontStyle = "italic";
  messageElement.style.backgroundColor = "#f1ece7";
  messageElement.style.display = "flex";
  messageElement.style.alignItems = "flex-start";
  messageElement.innerHTML = `
    <img src="${iconSrc}" width="50" height="50" style="margin-right: 0.5rem; border-radius: 50%;">
    <div>
      <strong style="color:#a67c52;">${data.name}</strong><br>${data.message}
    </div>
  `;
}
 else {
  messageElement.innerHTML = `<strong>${data.name}</strong><br>${data.message}`;
}

messagesDiv.appendChild(messageElement);

      messagesDiv.appendChild(messageElement);
    });
  });
});



      async function postMessage(button) {
  const section = button.closest('.board');
  const nameInput = section.querySelector('input[type="text"]');
  const textArea = section.querySelector('textarea');
  const name = nameInput.value.trim() || "匿名";
  const message = textArea.value.trim();
  if (message === "") return;

  // 投稿をFirebaseに保存
  const newMsgRef = db.ref("messages").push();
  await newMsgRef.set({ name: name, message: message, timestamp: Date.now() });

  // GPTに送信して返信を取得
  try {
    const res = await fetch(" https://us-central1-invitation0803.cloudfunctions.net/gptReply", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    message: message,
     })
});

    const data = await res.json();
    const reply = data.reply || "......";
    const emotion = data.emotion || "neutral";  // GPTから返ってくる感情パラメータ（仮）

    // GPTの返信もFirebaseに保存（名前を固定）
    const replyRef = db.ref("messages").push();
    await replyRef.set({
  name: "AI侑汰",
  message: reply,
  emotion: emotion,
  timestamp: Date.now()
});

  } catch (error) {
    console.error("GPTへの接続に失敗しました", error);
  }

  // フォームクリア
  nameInput.value = "";
  textArea.value = "";
}

    </script>
  </head>
  <body>
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.6); z-index: -1;"></div>
    <header class="animate-on-scroll">
      <h1 class="section-title">離婚式</h1>
      <img class="image" src="photo0.jpg" alt="">
      <p>謹啓 皆様におかれましては</p>
      <p>益々ご清祥のこととお慶び申し上げます</p>
      <p>かつて婚約していた元新郎  石橋侑汰は このたび離婚式を挙げ</p>
      <p>新しい第一歩を踏み出すことになりました</p>
      <p>つきましては 皆様により一層のご指導を賜りたく</p>
      <p>ささやかではございますが 離婚披露宴を催したく存じます</p>
      <p>ご多用中 誠に恐縮ではございますが</p>
      <p>ぜひご出席をお願いいたしたく ご案内申し上げます</p>
      <p>敬白</p>
      <br>
      <p>2025年8月</p>
      <p>石橋侑汰</p>

      <div style="position: relative; display: inline-block;">
        <img class="image" src="photo1.JPG" alt="結婚式の写真">
        <style>
@media (max-width: 768px) {
  .section1-text {
    top: 12%;
    right: 5%;
    font-size: 0.8rem;
  }
}
@media (min-width: 769px) {
  .section1-text {
    top: 6%;
    right: 5%;
    font-size: 1.5rem;
  }
}
</style>
<div style="position: absolute; text-align: right; z-index: 10; display: flex; flex-direction: column; align-items: flex-end;" class="section1-text">
  <div style="opacity: 1; margin-bottom: 0.5rem; font-weight: bold;">26年も生きてたら、ハプニングなんて朝飯前さ</div>
  <div style="opacity: 1;">人生の再出発に、乾杯。</div>
</div>
      </div>
      <p><strong>誰もが予想しなかったまさかの結末。</strong></p>
      <p><strong>折角なので全力で楽しみましょう！</strong></p>
    </header>

    <section class="animate-on-scroll">
        
      <h2 class="section-title">詳細</h2>
      <img class="image" src="photo2.jpg" alt="当日の予定の写真">
      <p><strong>日時</strong></p>
      <p>8/10 第一部(離婚披露宴)</p>
      <p>8/11 第二部(縁切りツアー)</p>
      <p style="color: crimson;">※集合時間については調整中ですので、<br>追ってアナウンスします。</p>
      <p><strong>場所</strong></p>
      <p>1日目：神奈川県三浦海岸(三浦 レンタルハウスYAMATOSHI)</p> 
      <p>JR三浦海岸駅より徒歩20分、バス停高抜より徒歩3分</p> 
      <div style="margin: 2rem auto; max-width: 800px;">
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3261.262419174975!2d139.6545341153443!3d35.1750114549618!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60183d3b01c7ad3d%3A0x213b4c06ea9abc49!2z5LiJ5rWmIOODrOODs-OCv-ODq-ODj-OCpuOCuVlBTUFUT1NISQ!5e0!3m2!1sja!2sjp!4v1754222036704!5m2!1sja!2sjp" width="100%" height="450" style="border:0; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);" allowfullscreen="" loading="lazy"></iframe>    
      </div>
    </section>

    <section class="animate-on-scroll">
      <h2 class="section-title">当日の流れ</h2>

      <div style="margin: 2rem auto; max-width: 500px;" class="item">
        <h3>離婚披露宴</h3>
        <img class="image" src="photo4.jpg" alt="BBQの写真">
        <p><strong>炭火で焼くのは肉だけじゃない、怒りと未練も一緒に焼き払え！</strong></p>

      </div>
      <div style="margin: 2rem auto; max-width: 500px;" class="item">
        <h3>2次会</h3>
        <img class="image" src="photo5.jpg" alt="宿泊の写真">
        <p>BBQとお酒で魂を浄化。朝にはすっきり新しい自分。</p>
      </div>
      <div style="margin: 2rem auto; max-width: 500px;" class="item">
        <h3>縁切りツアー(2日目)</h3>
        <img class="image" src="photo3.jpg" alt="栃木ツアーの写真">
        <p>日本有数の縁切り神社で旧き縁をバッサリ断ち切る。</p>
      </div>
    </section>

    <section class="animate-on-scroll">
      <h2 class="section-title">集合場所のご案内</h2>
      <p style="color: crimson;">集合場所は <strong>現在調整中</strong> です。<br>追ってアナウンスします。</p>
      <div style="margin: 2rem auto; max-width: 800px;">
        <iframe src="https://www.google.com/maps/embed?pb=!1m18..." width="100%" height="450" style="border:0; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);" allowfullscreen="" loading="lazy"></iframe>
      </div>
    </section>

    <section class="animate-on-scroll">
      <h2 class="section-title">元新郎へひとこと</h2>
      <p>とりあえず何でもいいんで、一言お願いします。</p>
      <img class="image" src="photo6.jpg" alt="掲示板の雰囲気写真" style="max-width: 80vw; height: auto; margin: 2rem auto; display: block; box-sizing: border-box;">
      <div class="board">
        <input type="text" placeholder="名前">
        <textarea placeholder="何でもどうぞ"></textarea>
        <button onclick="postMessage(this)">投稿</button>
        <p style="text-align: center; font-weight: bold; margin-top: 2rem;">皆さんからのコメント</p>
        <div class="messages" style="width: 100%; text-align: left;"></div>
      </div>
    </section>

    <script>
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      });
      document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
    </script>
  </body>
</html>